---
title: 'EDS 223: assignment 2'
author: "Sofia Ingersoll & Heather Childers"
output: html_document
date: "2023-10-28"
---
#QUESTIONS

- What do we input for CRS? WG 84 and ESPG 3857 are not working
- Is anything considered raster data?
- The numbers in the P_data columns are percentiles written as decimals - yes?
- Why is my data displaying the wrong things :\

```{r setup, include=FALSE}
knitr::opts_chunk$set(include = TRUE, message = FALSE, warning = FALSE)
```
Load relevant packages.
```{r include=TRUE, eval=FALSE}
library(tidyverse)
library(sf)
library(patchwork)
library(raster)
library(ggspatial)
library(tmap)
library(tmaptools)
library(cowplot)
library(terra)
```

Read in EJScreen data and filter to Los Angeles County
(5 points)
```{r include=TRUE, eval=FALSE, warning=FALSE, error=FALSE}
ejscreen <- st_read("../data/EJSCREEN_2023_BG_StatePct_with_AS_CNMI_GU_VI.gdb")

terra::crs(ejscreen)

california <- ejscreen %>%
  filter(ST_ABBREV == "CA") 

LAcounty <- ejscreen %>%
  filter(CNTY_NAME %in% c("Los Angeles County"))

LAcounty_mean <- aggregate(LAcounty, by = list(LAcounty$CNTY_NAME), FUN = mean)

LAcounty_blockgroup_centroids <- st_centroid(LAcounty)
```
Make a map of wastewater discharge (PWDIS) by census block groups. Indicate which census block groups are above the 95th percentile of national values for wastewater discharge by adding a centroid.
(10 points)

NEED BOTTOM COORDINATES

```{r}
LA <- ejscreen %>% 
  filter(CNTY_NAME %in% c("Los Angeles County"))

LA_95 <- LA %>%
  filter(P_PWDIS > 95)

tmap_mode ('plot')

tm_shape(LA) + 
  tm_fill(fill = "P_PWDIS",
          fill.scale = tm_scale(breaks = c(5,15,25.35,45,55,65,75,85,95,100)), 
          fill.legend = tm_legend(title = "Percentiles")) +
  tm_shape(LA_95) +
  tm_symbols(size = 0.1,
             col = "red") + 
  tm_graticules()
```

Find the percent of census block groups that have:  
- less than 5% of the population is considered low income
(5 points)
```{r}
LA_5 <- LA %>%
  filter(P_LOWINCPCT <= 5)

tmap_mode ('plot')

LA_LowIncome_map <- tm_shape(LA) + 
  tm_fill(fill = "LOWINCOME",
          fill.scale = tm_scale(breaks = c(5,15,25.35,45,55,65,75,85,95,100)), 
          fill.legend = tm_legend(title = "Percentiles")) +
  tm_shape(LA_5) +
  tm_symbols(size = 0.1,
             col = "red") + 
  tm_graticules()

LA_LowIncome_map
```
Find the percent of census block groups that are:    
- above the 80th percentile for Particulate Matter 2.5 AND  
- above the 80th percentile for Superfund proximity
(10 points)
```{r}
LA_80 <- LA %>%
  filter(P_PM25 > 80 & P_PNPL > 80)

above80 <- (nrow(LA_80)/nrow(LA))*100

print(above80)
```
Import redlining information for Los Angeles.
```{r include=TRUE, eval=FALSE, warning=FALSE, error=FALSE}
LA_redlining <- st_read("https://dsl.richmond.edu/panorama/redlining/static/downloads/geojson/CALosAngeles1939.geojson") %>%
  st_make_valid()
```
Make a map of historical redlining boundaries, colored by HOLC grade.
(5 points)
```{r}
LA_HOLC_grades <- LA_redlining %>% 
  group_by('holdc_grade')

tmap_mode('plot')

tm_shape(LA_HOLC_grades) + 
  tm_fill(fill = 'holc_grade', palette = c('green', 'blue', 'yellow', 'red')) +
  tm_graticules()

```
Find the number of census block groups that fall within areas with HOLC grades
hint: make sure the CRS match
(15 points)
```{r eval=FALSE}

only a number
```

Summarize current conditions based on EJScreen data within historical redlining categories using the mean of the following variables:  
-% low income.  
- percentile for particulate Matter 2.5.  
- percentile for low life expectancy.  
- percentile for air toxics cancer risk
(20 points)
```{r }
only a number

```

Please write 2-3 sentences reflecting on these results.
(5 points)










### Investigate the legacy of redlining in biodiversity observations

For bird observations from 2022 that fall within neighborhoods with HOLC grads, find the percent of observations within each redlining categories and plot results.
hint: make sure that the bird observations have the same CRS as redlining data.
(20 points)

Bar graph okay - Allie
````{r }
group_by holc & find average for each 

```

Please write 2-3 sentences reflecting on these results. Are they surprising? If so, why? What are some potential implications?
(5 points)






